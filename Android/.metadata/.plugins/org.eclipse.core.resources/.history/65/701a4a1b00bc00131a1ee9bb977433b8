package com.jellydiamonds.android.camera;

import java.util.List;

import android.hardware.Camera;

public class CameraConfigurator {
	
	public static final int DEFAULT_DISPLAY_ORIENTATION_DEGREE = 90;
	public static final int DEFAULT_PICTURE_ORIENTATION_DEGREE = 90;
	
	private static Camera.Parameters smParameter = null;
	private static int				 smWidthArea = 0;
	private static int				 smHeightArea = 0;
	private static float			 smAspectRatio = Float.MAX_VALUE;
	
	
	public static boolean setOptimalDefaultConfiguration( Camera camera, int widthZone, int heightZone )
	{
		Camera.Parameters 		l_tmp_parameter = null;
		Camera.Size				l_tmp_previewSize = null;
		Camera.Size				l_tmp_pictureSize = null;
		float				  	l_aspect_ratio = Float.MAX_VALUE;
		
		if( 	( camera == null ) || 
				( widthZone == 0 ) || 
				( heightZone == 0 ) 	)
			return false;
		
		camera.setDisplayOrientation( DEFAULT_DISPLAY_ORIENTATION_DEGREE );
		
		if( 	( smParameter != null ) &&
				( widthZone == smWidthArea) &&
				( heightZone == smHeightArea) )
		{
			camera.setParameters( smParameter );
			return true;
		}
		
		l_aspect_ratio = ( (float)widthZone ) / ( (float)heightZone );	// Zone aspect ratio
		l_tmp_parameter = camera.getParameters();						// Current Camera parameter
		l_tmp_previewSize = getBestPreviewSize( l_tmp_parameter.getSupportedPreviewSizes(), widthZone, heightZone, l_aspect_ratio); // Compute best ratio
		
		if( l_tmp_previewSize == null )
			return false;
		
		return true;
		
	}
	
	private static Camera.Size getBestPreviewSize( List<Camera.Size> previewSize, int widthZone, int heightZone, float aspectRatio )
	{
		Camera.Size l_result = null;
		float 		l_smallestRatioDifference = Float.MAX_VALUE;
		
		for( Camera.Size l_current_size : previewSize)
		{
			float l_currentRatio = ( (float)l_current_size.width ) / ( (float) l_current_size.height );
			
			if( ( Math.abs( aspectRatio - l_currentRatio) < l_smallestRatioDifference ) 	&& // Retrieveing the smallest difference between screen ratio and resolution ratio
					l_current_size.width <= widthZone 							&& // width of current resolution should be lower or equal zone
					l_current_size.height <= heightZone		)					   // height of current resolution should be lower or equal zone	
			{
				l_smallestRatioDifference = Math.abs( aspectRatio - l_currentRatio );			// Now smallestratiodifference is reevaluated 
				l_result = l_current_size;														// Selected size has better ratio
			}
		}
		
		return l_result;
	}
	
	private static Camera.Size getBestPictureSize( List<Camera.Size> pictureSize, Camera.Size previewSizeSelected )
	{
		Camera.Size l_result = null;
		
		return l_result ;
	}
	
	
	

}
